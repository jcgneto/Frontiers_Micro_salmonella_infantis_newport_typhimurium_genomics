---
title: "clonality of each pca cluster through baps1-6"
author: "Joao Carlos Gomes-Neto"
date: "4/7/2021"
output: html_document
---

Assess the clonality of each PCA cluster using BAPS1-6 haplotype analysis 

```{r, include = FASE}
# BAPS1

baps <- read_csv('~/Documents/frontiers_paper_salmonella_newport_typhimurium/data/infantis/input_data/fastbaps_partition_baps_prior_l6.csv')

# Changing column names 

colnames(baps)[1:7] <- c("id", "BAPS1", "BAPS2", "BAPS3", "BAPS4", "BAPS5", "BAPS6") 


d1 <- baps

# PCA CLUSTER

data2 <- read_csv("~/Documents/frontiers_paper_salmonella_newport_typhimurium/data/infantis/pca_infantis/cluster2.csv")

d2 <- data2 %>% select(-X1)
#############################################################################################
#############################################################################################

# combining all datasets

d3 <- left_join(d1, d2, on = "id")
d3 <- d3 %>% mutate(pca = ifelse(cluster == "1", "Cluster 1", "Cluster 2"))
d4 <- d3 %>% select(-cluster)

#####################################

# Baps based diversity 

# Baps1
baps1 <- d4 %>%
              select(pca, BAPS1) %>%
              drop_na(pca, BAPS1) %>%
              group_by(pca, BAPS1) %>%
              summarise(n = n()) %>%
              mutate(total = sum(n)) %>% 
              mutate(prop = n/total*100) %>%
              mutate(group = "BAPS1") %>%
              rename(baps = BAPS1)

# Baps2
baps2 <- d4 %>%
              select(pca, BAPS2) %>%
              drop_na(pca, BAPS2) %>%
              group_by(pca, BAPS2) %>%
              summarise(n = n()) %>%
              mutate(total = sum(n)) %>% 
              mutate(prop = n/total*100) %>%
              mutate(group = "BAPS2") %>%
              rename(baps = BAPS2)

# Baps3
baps3 <- d4 %>%
              select(pca, BAPS3) %>%
              drop_na(pca, BAPS3) %>%
              group_by(pca, BAPS3) %>%
              summarise(n = n()) %>%
              mutate(total = sum(n)) %>% 
              mutate(prop = n/total*100) %>%
              mutate(group = "BAPS3") %>%
              rename(baps = BAPS3)


# Baps4
baps4 <- d4 %>%
              select(pca, BAPS4) %>%
              drop_na(pca, BAPS4) %>%
              group_by(pca, BAPS4) %>%
              summarise(n = n()) %>%
              mutate(total = sum(n)) %>% 
              mutate(prop = n/total*100) %>%
              mutate(group = "BAPS4") %>%
              rename(baps = BAPS4)

# Baps5
baps5 <- d4 %>%
              select(pca, BAPS5) %>%
              drop_na(pca, BAPS5) %>%
              group_by(pca, BAPS5) %>%
              summarise(n = n()) %>%
              mutate(total = sum(n)) %>% 
              mutate(prop = n/total*100) %>%
              mutate(group = "BAPS5") %>%
              rename(baps = BAPS5)

              # Baps6
baps6 <- d4 %>%
              select(pca, BAPS6) %>%
              drop_na(pca, BAPS6) %>%
              group_by(pca, BAPS6) %>%
              summarise(n = n()) %>%
              mutate(total = sum(n)) %>% 
              mutate(prop = n/total*100) %>%
              mutate(group = "BAPS6") %>%
              rename(baps = BAPS6)

# Concatenate all datasets

d5 <- rbind(baps1, baps2, baps3, baps4, baps5, baps6)
d5$group <- factor(d5$group, levels=c("BAPS1", "BAPS2", "BAPS3",
                                              "BAPS4", "BAPS5", "BAPS6"))

# plot data

plot1 <- ggplot(d5, aes(x = baps, y = prop, fill = pca))  + xlim(0, 100) +
  theme_bw() +
  geom_col(position = "dodge")+
  xlab("BAPS sub-groups (haplotypes)") +
  ylab("Proportion") +
    theme(axis.text.x = element_text(angle = 0, size = 25)) +
  theme(axis.title.x = element_text(size = 35, face = "bold")) +
  theme(axis.title.y = element_text(size = 35, face = "bold")) +
  theme(axis.text.y = element_text(angle = 0, hjust = 1, size = 25)) +
  theme(legend.title=element_text(size=35, face = "bold"))+
  theme(legend.text=element_text(size=25)) +
  scale_fill_manual(name = "PCA-clusters", values=c("darkblue", "orange")) +
  theme(strip.text.x = element_text(size = 35)) +
  facet_wrap(~group, ncol = 3) 
plot1
```